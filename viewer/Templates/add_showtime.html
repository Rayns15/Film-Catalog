{% extends 'base.html' %}
{% load static %}
{% load sorting_tags %} {% block title %}
    {% if object %}
        Update Showtime
    {% else %}
        Showtime Manager
    {% endif %}
{% endblock %}

{% block content %}
<style>
    /* ... (Stilurile dvs. existente sunt perfecte) ... */
    .form-control {
        width: 100%;
        padding: 10px 14px;
        border-radius: 8px; /* rounded-lg */
        border: 1px solid #4B5563; /* border-gray-600 */
        background-color: #374151; /* bg-gray-700 */
        color: #FFFFFF; /* text-white */
        transition: all 0.15s ease;
    }
    .form-control:focus {
        outline: none;
        border-color: #6366F1; /* focus:ring-indigo-500 */
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.4); /* focus:ring-2 */
    }
    input[type="datetime-local"].form-control,
    input[type="date"].form-control { /* <-- Am adƒÉugat »ôi input[type="date"] pentru filtru */
        color-scheme: dark;
    }

    /* */
    .filter-input {
        background-color: #374151;
        border: 1px solid #4B5563;
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 0.875rem;
    }
    .filter-input:focus {
        outline: none;
        border-color: #6366F1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.4);
    }
    .filter-btn {
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.15s ease;
    }
    .filter-btn-apply {
        background-color: #4f46e5; /* indigo-600 */
        color: white;
    }
    .filter-btn-apply:hover { background-color: #4338ca; } /* indigo-700 */
    
    .filter-btn-clear {
        background-color: #4B5563; /* gray-600 */
        color: white;
    }
    .filter-btn-clear:hover { background-color: #374151; } /* gray-700 */
    /* */

</style>

<div class="w-full max-w-screen-xl mx-auto px-2 sm:px-4 md:px-8 py-10">

    <div class="max-w-2xl mx-auto bg-gray-900/50 backdrop-blur-md rounded-xl shadow-lg overflow-hidden border border-gray-700 mb-16">
        
        <form method="post" class="p-6 sm:p-8 space-y-6">
            {% csrf_token %}

            <div>
                <label for="{{ form.movie.id_for_label }}" class="block text-sm font-medium text-gray-300 mb-2">{{ form.movie.label }}</label>
                {{ form.movie }} {% if form.movie.errors %}<div class="text-red-400 text-sm mt-1">{{ form.movie.errors }}</div>{% endif %}
            </div>
            
            <div>
                <label for="{{ form.cinema.id_for_label }}" class="block text-sm font-medium text-gray-300 mb-2">{{ form.cinema.label }}</label>
                {{ form.cinema }} {% if form.cinema.errors %}<div class="text-red-400 text-sm mt-1">{{ form.cinema.errors }}</div>{% endif %}
            </div>

            <div>
                <label for="{{ form.show_time.id_for_label }}" class="block text-sm font-medium text-gray-300 mb-2">{{ form.show_time.label }}</label>
                {{ form.show_time }} {% if form.show_time.errors %}<div class="text-red-400 text-sm mt-1">{{ form.show_time.errors }}</div>{% endif %}
            </div>

            <div class="flex flex-col sm:flex-row items-center {% if object %}justify-between{% else %}justify-end{% endif %} gap-4 pt-6 border-t border-gray-700">
                
                {% if object %}
                <a href="{% url 'showtime_delete' object.pk %}" class="text-center bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition font-medium w-full sm:w-auto">
                    Delete
                </a>
                {% endif %}
                
                <div class="flex flex-col sm:flex-row justify-end gap-4 w-full sm:w-auto">
                    
                    {% if object %}
                        <a href="{% url 'showtime_create' %}" class="text-center bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700 transition font-medium">
                            Add New
                        </a>
                    {% endif %}
                    <a href="{% url 'showtime_create' %}" class="text-center bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition font-medium">
                        Cancel
                    </a>
                    <button type="submit" class="bg-indigo-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-indigo-700 transition">
                        {% if object %}
                            Update Showtime
                        {% else %}
                            Save Showtime
                        {% endif %}
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div class="max-w-5xl mx-auto">
        <h2 class="text-3xl font-extrabold text-white text-center mb-8">
            <span class='bg-clip-text bg-gradient-to-r from-teal-300 to-green-400 text-transparent'>
                Existing Showtimes 
            </span>
            <span>
                üçø
            </span>
        </h2>
        
        <form method="get" action="" class="mb-6 p-4 bg-gray-900/50 backdrop-blur-md border border-gray-700 rounded-xl shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <div>
                    <label for="movie_filter" class="block text-sm font-medium text-gray-300 mb-2">Filter by Movie</label>
                    <input type="text" name="movie_filter" id="movie_filter" class="w-full filter-input" placeholder="Inception..." value="{{ request.GET.movie_filter }}">
                </div>
                <div>
                    <label for="cinema_filter" class="block text-sm font-medium text-gray-300 mb-2">Filter by Cinema</label>
                    <input type="text" name="cinema_filter" id="cinema_filter" class="w-full filter-input" placeholder="Le Grand Rex..." value="{{ request.GET.cinema_filter }}">
                </div>
                <div>
                    <label for="date_filter" class="block text-sm font-medium text-gray-300 mb-2">Filter by Date</label>
                    <input type="date" name="date_filter" id="date_filter" class="w-full filter-input form-control" value="{{ request.GET.date_filter }}">
                </div>
                <div class="flex flex-col sm:flex-row gap-2">
                    <button type="submit" class="w-full filter-btn filter-btn-apply">Filter</button>
                    <a href="{% url 'showtime_create' %}" class="w-full text-center filter-btn filter-btn-clear">Clear</a>
                </div>
            </div>
        </form>
        
        {% if showtime_list %}
            <div class="bg-gray-900/50 backdrop-blur-md border border-gray-700 rounded-xl shadow-lg overflow-hidden">
                <table class="min-w-full divide-y divide-gray-700">
                    
                    <thead class="bg-gray-800/50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                {% sorted_url "movie__title" as movie_sort_url %}
                                <a href="?{{ movie_sort_url }}" class="hover:text-white transition">
                                    Movie
                                    {% if current_sort == "movie__title" %} <span>‚ñ≤</span>
                                    {% elif current_sort == "-movie__title" %} <span>‚ñº</span>
                                    {% endif %}
                                </a>
                            </th>
                            
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                {% sorted_url "cinema__name" as cinema_sort_url %}
                                <a href="?{{ cinema_sort_url }}" class="hover:text-white transition">
                                    Cinema
                                    {% if current_sort == "cinema__name" %} <span>‚ñ≤</span>
                                    {% elif current_sort == "-cinema__name" %} <span>‚ñº</span>
                                    {% endif %}
                                </a>
                            </th>

                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                {% sorted_url "show_time" as time_sort_url %}
                                <a href="?{{ time_sort_url }}" class="hover:text-white transition">
                                    Show Time
                                    {% if current_sort == "show_time" %} <span>‚ñ≤</span>
                                    {% elif current_sort == "-show_time" %} <span>‚ñº</span>
                                    {% endif %}
                                </a>
                            </th>

                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-800">
                        {% for show in showtime_list %}
                        <tr class="hover:bg-gray-800/60 transition">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">{{ show.movie.title }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ show.cinema.name }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ show.show_time|date:"D, M d, Y - g:i A" }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-3">
                                <a href="{% url 'showtime_update' show.pk %}" class="text-indigo-400 hover:text-indigo-300 transition">
                                    Update
                                </a>
                                <a href="{% url 'showtime_delete' show.pk %}" class="text-red-500 hover:text-red-400 transition">
                                    Delete
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        
        {% else %}
            <div class="text-center py-10 bg-gray-900/50 backdrop-blur-md rounded-xl border border-gray-700">
                <p class="text-gray-400">No showtimes match your filters or none are scheduled.</p> </div>
        {% endif %}
    </div>
</div>
{% endblock %}